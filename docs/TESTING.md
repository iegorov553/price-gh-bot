# üß™ –ò—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Price-GH-Bot, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–æ–≤)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
4. [–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤](#–∑–∞–ø—É—Å–∫-—Ç–µ—Å—Ç–æ–≤)
5. [–¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤](#—Ç–∏–ø—ã-—Ç–µ—Å—Ç–æ–≤)
6. [–ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤](#–Ω–∞–ø–∏—Å–∞–Ω–∏–µ-–Ω–æ–≤—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
7. [CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#cicd-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
8. [–û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞](#–æ—Ç–ª–∞–¥–∫–∞-–∏-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
9. [–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö](#–∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–¥–∞–Ω–Ω—ã—Ö)
10. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üéØ –¶–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Price-GH-Bot —Ä–µ—à–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ–º–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- **–ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–†–µ–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –∂–∏–≤—ã–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### üèóÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤**: –ú–Ω–æ–≥–æ –±—ã—Å—Ç—Ä—ã—Ö unit —Ç–µ—Å—Ç–æ–≤, –º–µ–Ω—å—à–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö E2E
2. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω
3. **–ú–æ–∫–∏ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏**: –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–æ–∫–∞—é—Ç—Å—è –≤ unit/integration —Ç–µ—Å—Ç–∞—Ö
4. **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏**: E2E —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ API
5. **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞**: –ú–∏–Ω–∏–º—É–º 70%, —Ü–µ–ª—å 80%+
- **–°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: Unit < 1—Å, Integration < 5—Å, E2E < 60—Å
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: 95%+ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤ –≤ CI/CD
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –±–∞–≥–æ–≤**: –ö–∞–∂–¥—ã–π –±–∞–≥ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –Ω–æ–≤–æ–º—É —Ç–µ—Å—Ç—É

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
tests_new/
‚îú‚îÄ‚îÄ unit/                           # –ë—ã—Å—Ç—Ä—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_commission_contracts.py    # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_shipping_contracts.py      # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ test_currency_contracts.py      # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∞–ª—é—Ç
‚îú‚îÄ‚îÄ integration/                    # –¢–µ—Å—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ test_bot_handlers.py            # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ e2e/                           # –°–∫–≤–æ–∑–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ test_real_urls.py               # –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ URL
‚îú‚îÄ‚îÄ fixtures/                      # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_data.json                  # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ generated_fixtures.py           # –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ utils/                         # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ data_updater.py                 # –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ conftest.py                    # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã pytest
‚îî‚îÄ‚îÄ README.md                      # –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
```

### üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ—Å—Ç–∞—Ö

```mermaid
graph TD
    A[conftest.py] --> B[Unit Tests]
    A --> C[Integration Tests]
    A --> D[E2E Tests]
    
    E[fixtures/test_data.json] --> A
    F[utils/data_updater.py] --> E
    
    G[Real Services] --> F
    G --> D
    
    B --> H[Coverage Report]
    C --> H
    D --> H
    
    H --> I[CI/CD Pipeline]
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.11+**: –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä
- **Docker**: –î–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Playwright**: –î–ª—è headless browser —Ç–µ—Å—Ç–æ–≤
- **Git**: –î–ª—è pre-commit —Ö—É–∫–æ–≤

### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# 1. –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt -r requirements-dev.txt

# 2. Browser –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤
playwright install chromium

# 3. Pre-commit —Ö—É–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
pre-commit install

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
pytest --version
playwright --version
```

### üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
```bash
# –¢–æ–∫–µ–Ω —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
export BOT_TOKEN=8026508902:AAGWJKei_EyPkpc4x-lt-qFQo53829gQIrU
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
```bash
# –†–µ–∂–∏–º headless browser (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: false –≤ —Ç–µ—Å—Ç–∞—Ö)
export ENABLE_HEADLESS_BROWSER=true

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: INFO)
export LOG_LEVEL=DEBUG

# –ú–∞—Ä–∫–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export ENVIRONMENT=test

# Timeout –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (—Å–µ–∫—É–Ω–¥—ã)
export TEST_TIMEOUT=120
```

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### pytest.ini
```ini
[tool:pytest]
testpaths = tests_new
addopts = --strict-markers --verbose --tb=short --cov-config=.coveragerc
markers = 
    unit: –ë—ã—Å—Ç—Ä—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
    integration: –¢–µ—Å—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    e2e: –°–∫–≤–æ–∑–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
    slow: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (>5 —Å–µ–∫—É–Ω–¥)
    network: –¢–µ—Å—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
```

#### .coveragerc
```ini
[run]
source = app
branch = True
omit = tests_new/*, venv/*

[report]
fail_under = 70
show_missing = True
```

---

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### üèÉ‚Äç‚ôÇÔ∏è –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

#### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –í—Å–µ unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–æ, ~10 —Å–µ–∫—É–Ω–¥)
BOT_TOKEN=8026508902:AAGWJKei_EyPkpc4x-lt-qFQo53829gQIrU pytest tests_new/unit/ -v

# –í—Å–µ integration —Ç–µ—Å—Ç—ã (~30 —Å–µ–∫—É–Ω–¥)
BOT_TOKEN=8026508902:AAGWJKei_EyPkpc4x-lt-qFQo53829gQIrU pytest tests_new/integration/ -v

# –í—Å–µ E2E —Ç–µ—Å—Ç—ã (–º–µ–¥–ª–µ–Ω–Ω–æ, ~5 –º–∏–Ω—É—Ç)
BOT_TOKEN=8026508902:AAGWJKei_EyPkpc4x-lt-qFQo53829gQIrU ENABLE_HEADLESS_BROWSER=true pytest tests_new/e2e/ -v

# –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–¥—Ä—è–¥
BOT_TOKEN=8026508902:AAGWJKei_EyPkpc4x-lt-qFQo53829gQIrU pytest tests_new/ -v
```

#### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã
```bash
# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest tests_new/ --cov=app --cov-report=html --cov-report=term

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest tests_new/ -x

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ—É–¥–∞–≤—à–∏–µ—Å—è —Ç–µ—Å—Ç—ã
pytest tests_new/ --lf

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
pytest tests_new/ -v -s --tb=long

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests_new/unit/test_commission_contracts.py::TestCommissionContracts::test_commission_calculation_contract -v

# –¢–µ—Å—Ç—ã –ø–æ –º–∞—Ä–∫–µ—Ä—É
pytest tests_new/ -m "unit and not slow" -v

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
pytest tests_new/ -n auto
```

### üõ†Ô∏è Makefile –∫–æ–º–∞–Ω–¥—ã

```bash
# –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
make test-unit           # –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã
make test-integration    # Integration —Ç–µ—Å—Ç—ã
make test-e2e           # E2E —Ç–µ—Å—Ç—ã
make test-all           # –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
make test-coverage      # –¢–µ—Å—Ç—ã —Å –æ—Ç—á—ë—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è

# Docker –∫–æ–º–∞–Ω–¥—ã  
make test-docker        # –í—Å–µ —Ç–µ—Å—Ç—ã –≤ Docker
make test-docker-unit   # Unit —Ç–µ—Å—Ç—ã –≤ Docker
make test-docker-dev    # Development –æ–∫—Ä—É–∂–µ–Ω–∏–µ

# –£—Ç–∏–ª–∏—Ç—ã
make test-update-data   # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
make test-verify        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL
make clean-test         # –û—á–∏—Å—Ç–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
```

### üê≥ Docker —Ä–µ–∂–∏–º—ã

#### –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
docker-compose -f docker-compose.test.yml up test-all --build

# –û—Ç–¥–µ–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–æ–≤
docker-compose -f docker-compose.test.yml up test-unit --build
docker-compose -f docker-compose.test.yml up test-integration --build
docker-compose -f docker-compose.test.yml up test-e2e --build

# –° –æ—Ç—á—ë—Ç–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
docker-compose -f docker-compose.test.yml up test-coverage --build
```

#### Development —Ä–µ–∂–∏–º
```bash
# –ó–∞–ø—É—Å–∫ development –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose -f docker-compose.test.yml up test-dev -d

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it $(docker-compose -f docker-compose.test.yml ps -q test-dev) bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
pytest tests_new/unit/ -v
pytest tests_new/integration/ -v --pdb  # –° –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
```

---

## –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### üéØ Unit —Ç–µ—Å—Ç—ã (tests_new/unit/)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–æ–¥—É–ª–µ–π

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ < 1 —Å–µ–∫—É–Ω–¥—ã –∫–∞–∂–¥—ã–π
- –ë–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

#### test_commission_contracts.py
```python
def test_commission_calculation_contract(self, commission_test_cases, mock_config):
    """–¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏."""
    for item_price, us_shipping, expected_commission, commission_type, description in commission_test_cases:
        result = calculate_final_price(
            Decimal(str(item_price)), 
            Decimal(str(us_shipping)), 
            Decimal("25.00")
        )
        assert result.commission == Decimal(str(expected_commission))
```

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –†–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∏–∂–µ/–≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ $150
- –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ ($149.99, $150.00, $150.01)
- –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Å Decimal
- –ù—É–ª–µ–≤—ã–µ –∏ –±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ PriceCalculation

#### test_shipping_contracts.py
```python
def test_shipping_estimation_contract(self, shipping_test_cases, mock_config):
    """–¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –æ—Ü–µ–Ω–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏."""
    for title, expected_weight, description in shipping_test_cases:
        result = estimate_shopfans_shipping(title)
        assert result.weight_kg == Decimal(str(expected_weight))
```

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (hoodie, sneakers, t-shirt, tie)
- –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ Shopfans
- –ú–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å –≤–µ—Å–æ–º

#### test_currency_contracts.py
```python
async def test_successful_exchange_rate_parsing(self, mock_cbr_api, mock_http_session):
    """–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫—É—Ä—Å–∞ CBR."""
    rate = await get_rate("USD", "RUB", mock_http_session)
    assert rate.rate == Decimal("100.28")  # 95.5 * 1.05
    assert rate.markup_percentage == 5.0
```

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –ü–∞—Ä—Å–∏–Ω–≥ XML –æ—Ç–≤–µ—Ç–∞ CBR API
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ 5% –Ω–∞—Ü–µ–Ω–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–æ–≤
- –¢–æ—á–Ω–æ—Å—Ç—å –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏ —Å Decimal

### üîó Integration —Ç–µ—Å—Ç—ã (tests_new/integration/)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –º–æ–∫–∞–º–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ < 5 —Å–µ–∫—É–Ω–¥ –∫–∞–∂–¥—ã–π
- –ú–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API (eBay, Grailed, CBR)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### test_bot_handlers.py
```python
async def test_handle_listing_full_flow(self, mock_config, mock_http_session, sample_item_data):
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∏—Å—Ç–∏–Ω–≥–∞."""
    with patch('app.scrapers.ebay.scrape_ebay_item') as mock_scrape:
        mock_scrape.return_value = sample_item_data['ebay_item']
        await handle_link(update, context)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤—ã–∑–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –æ—Ç URL –¥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö URL –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–≤—Ü–∞ –¥–ª—è Grailed –ª–∏—Å—Ç–∏–Ω–≥–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ offer-only —Ç–æ–≤–∞—Ä–æ–≤
- Graceful handling –æ—à–∏–±–æ–∫ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

### üåê E2E —Ç–µ—Å—Ç—ã (tests_new/e2e/)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–∫–≤–æ–∑–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ < 60 —Å–µ–∫—É–Ω–¥ –∫–∞–∂–¥—ã–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö API
- –ú–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

#### test_real_urls.py
```python
async def test_ebay_real_listing(self):
    """–¢–µ—Å—Ç —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ eBay –ª–∏—Å—Ç–∏–Ω–≥–∞."""
    test_url = "https://www.ebay.com/itm/266024628787"
    item_data = await ebay.scrape_ebay_item(test_url, session)
    if item_data is None:
        pytest.skip("eBay listing not accessible")
    assert item_data.price > Decimal("0")
```

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –°–∫—Ä–∞–ø–∏–Ω–≥ —Ä–µ–∞–ª—å–Ω—ã—Ö eBay –ª–∏—Å—Ç–∏–Ω–≥–æ–≤
- –°–∫—Ä–∞–ø–∏–Ω–≥ —Ä–µ–∞–ª—å–Ω—ã—Ö Grailed –ª–∏—Å—Ç–∏–Ω–≥–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø—Ä–æ–¥–∞–≤—Ü–æ–≤ —Å headless browser
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç –∏–∑ CBR API
- –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ—Ç URL –¥–æ RUB
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–∫—Ä–∞–ø–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö URL
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ Grailed shortlinks

---

## –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### üìù –®–∞–±–ª–æ–Ω Unit —Ç–µ—Å—Ç–∞

```python
"""–ú–æ–¥—É–ª—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è [–û–ü–ò–°–ê–ù–ò–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–ò]."""

import pytest
from decimal import Decimal
from unittest.mock import patch, AsyncMock

from app.module_to_test import function_to_test


class TestFunctionName:
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ function_to_test."""
    
    def test_normal_case(self, mock_config):
        """–¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Å–ª—É—á–∞—è —Ä–∞–±–æ—Ç—ã."""
        # Arrange (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
        input_data = "test_input"
        expected_output = "expected_result"
        
        # Act (–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
        result = function_to_test(input_data)
        
        # Assert (–ø—Ä–æ–≤–µ—Ä–∫–∞)
        assert result == expected_output, f"Expected {expected_output}, got {result}"
    
    def test_edge_case(self, mock_config):
        """–¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–ª—É—á–∞—è."""
        # –¢–µ—Å—Ç —Å –≥—Ä–∞–Ω–∏—á–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
        pass
    
    def test_error_handling(self, mock_config):
        """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫."""
        with pytest.raises(ValueError, match="Expected error message"):
            function_to_test(invalid_input)
    
    @pytest.mark.parametrize("input_val,expected", [
        ("case1", "result1"),
        ("case2", "result2"),
        ("case3", "result3"),
    ])
    def test_multiple_cases(self, input_val, expected, mock_config):
        """–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤."""
        assert function_to_test(input_val) == expected
```

### üìù –®–∞–±–ª–æ–Ω Integration —Ç–µ—Å—Ç–∞

```python
"""Integration —Ç–µ—Å—Ç—ã –¥–ª—è [–û–ü–ò–°–ê–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–ê]."""

import pytest
from unittest.mock import patch, AsyncMock

from app.component import ComponentClass


class TestComponentIntegration:
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞."""
    
    @pytest.mark.asyncio
    async def test_component_workflow(self, mock_config, mock_http_session):
        """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ workflow –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞."""
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–∫–æ–≤
        with patch('app.external.service') as mock_service:
            mock_service.return_value = "mocked_response"
            
            # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
            component = ComponentClass()
            result = await component.process_data("test_input")
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∏
            assert result is not None
            mock_service.assert_called_once_with("test_input")
```

### üìù –®–∞–±–ª–æ–Ω E2E —Ç–µ—Å—Ç–∞

```python
"""E2E —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏."""

import pytest

from app.real_service import RealServiceClient


class TestRealServiceE2E:
    """E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º."""
    
    @pytest.mark.asyncio
    @pytest.mark.timeout(30)
    @pytest.mark.network
    async def test_real_service_integration(self):
        """–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º."""
        client = RealServiceClient()
        
        try:
            result = await client.fetch_data("test_query")
            
            if result is None:
                pytest.skip("Service not accessible")
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            assert result.status == "success"
            assert len(result.data) > 0
            
        except Exception as e:
            pytest.fail(f"Service integration failed: {e}")
```

### üéØ –ú–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```python
import pytest

@pytest.mark.unit          # –ë—ã—Å—Ç—Ä—ã–π unit —Ç–µ—Å—Ç
@pytest.mark.integration   # Integration —Ç–µ—Å—Ç
@pytest.mark.e2e          # End-to-end —Ç–µ—Å—Ç
@pytest.mark.slow         # –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç (>5 —Å–µ–∫—É–Ω–¥)
@pytest.mark.network      # –¢—Ä–µ–±—É–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
@pytest.mark.browser      # –¢—Ä–µ–±—É–µ—Ç headless browser
@pytest.mark.real_data    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
@pytest.mark.skip         # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
@pytest.mark.xfail        # –û–∂–∏–¥–∞–µ—Ç—Å—è –ø–∞–¥–µ–Ω–∏–µ
@pytest.mark.timeout(60)  # Timeout –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
```

### üß™ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
# –í conftest.py –∏–ª–∏ –≤ –Ω–∞—á–∞–ª–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

@pytest.fixture
def sample_data():
    """–ü—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤."""
    return {
        "item_price": Decimal("100.00"),
        "shipping_cost": Decimal("15.00"),
        "description": "Test item description"
    }

@pytest.fixture
async def async_client():
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤."""
    async with aiohttp.ClientSession() as session:
        yield session

@pytest.fixture(scope="session")
def expensive_setup():
    """–î–æ—Ä–æ–≥–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é."""
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞
    yield "configured_resource"
    # –û—á–∏—Å—Ç–∫–∞
```

---

## CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### üè≠ GitHub Actions Workflow

–§–∞–π–ª `.github/workflows/test-and-deploy.yml` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω:

```mermaid
graph LR
    A[Push/PR] --> B[Lint]
    B --> C[Unit Tests]
    C --> D[Integration Tests]
    D --> E[Security Scan]
    E --> F[Docker Build]
    F --> G[E2E Tests]
    G --> H[Deploy]
```

#### –≠—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞

1. **Lint & Format** (2-3 –º–∏–Ω—É—Ç—ã)
   ```bash
   ruff check app/ tests_new/
   ruff format --check app/ tests_new/
   mypy app/
   pydocstyle app/
   ```

2. **Unit Tests** (1-2 –º–∏–Ω—É—Ç—ã)
   ```bash
   pytest tests_new/unit/ -v --cov=app --cov-report=xml
   ```

3. **Integration Tests** (3-5 –º–∏–Ω—É—Ç)
   ```bash
   pytest tests_new/integration/ -v --cov=app --cov-append
   ```

4. **Security Scan** (1-2 –º–∏–Ω—É—Ç—ã)
   ```bash
   safety check
   bandit -r app/
   ```

5. **Docker Build Test** (2-3 –º–∏–Ω—É—Ç—ã)
   ```bash
   docker build -f Dockerfile.test .
   ```

6. **E2E Tests** (5-10 –º–∏–Ω—É—Ç, —Ç–æ–ª—å–∫–æ –Ω–∞ main)
   ```bash
   pytest tests_new/e2e/ -v --timeout=120
   ```

7. **Deploy** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤)

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

–í GitHub Repository Settings ‚Üí Secrets:
```
TEST_BOT_TOKEN: 8026508902:AAGWJKei_EyPkpc4x-lt-qFQo53829gQIrU
CODECOV_TOKEN: [—Ç–æ–∫–µ–Ω –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –ø–æ–∫—Ä—ã—Ç–∏—è]
```

#### –£—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **Unit/Integration**: –ù–∞ –∫–∞–∂–¥—ã–π push –∏ PR
- **E2E**: –¢–æ–ª—å–∫–æ –Ω–∞ push –≤ main/develop
- **Deploy**: –¢–æ–ª—å–∫–æ –Ω–∞ push –≤ main –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

### ü™ù Pre-commit —Ö—É–∫–∏

–§–∞–π–ª `.pre-commit-config.yaml` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
pre-commit install

# –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
pre-commit run --all-files

# –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
# - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (Ruff)
# - –°–∏–Ω—Ç–∞–∫—Å–∏—Å YAML/JSON
# - –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã
# - Trailing whitespace
```

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. ImportError –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
ImportError: cannot import name 'function_name' from 'app.module'

# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PYTHONPATH –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–º–ø–æ—Ä—Ç–æ–≤
export PYTHONPATH=/home/iegorov553/projects/price-gh-bot:$PYTHONPATH
python -c "import app.module; print(dir(app.module))"
```

#### 2. –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ pytest
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π pytest.ini
ERROR: /path/to/pytest.ini:42: unexpected line

# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
pytest --collect-only  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

#### 3. Timeout –≤ E2E —Ç–µ—Å—Ç–∞—Ö
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏
TimeoutError: Test exceeded 30 seconds

# –†–µ—à–µ–Ω–∏–µ: –£–≤–µ–ª–∏—á–∏—Ç—å timeout –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
pytest tests_new/e2e/ --timeout=120
```

#### 4. –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: eBay/Grailed –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
ConnectionError: Unable to connect to ebay.com

# –†–µ—à–µ–Ω–∏–µ: Skip E2E —Ç–µ—Å—Ç—ã –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å URL
pytest tests_new/unit/ tests_new/integration/ -v
```

#### 5. –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
```bash
# –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
AssertionError: Expected weight 0.8, got 0.7

# –†–µ—à–µ–Ω–∏–µ: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
python tests_new/utils/data_updater.py
```

### üîç –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
```bash
# –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
pytest tests_new/ -v -s --tb=long --show-capture=all

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
pytest tests_new/unit/test_commission_contracts.py::test_specific --pdb

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
pytest tests_new/ --profile --profile-svg
```

#### –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è
```bash
# –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ–∫—Ä—ã—Ç–∏—è
pytest tests_new/ --cov=app --cov-report=html --cov-report=term-missing

# –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
pytest tests_new/ --cov=app.services.currency --cov-report=term

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö —Å—Ç—Ä–æ–∫
coverage report --show-missing
```

#### –í—ã–±–æ—Ä–æ—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```bash
# –¢–æ–ª—å–∫–æ –Ω–µ—É–¥–∞–≤—à–∏–µ—Å—è —Ç–µ—Å—Ç—ã
pytest tests_new/ --lf

# –¢–µ—Å—Ç—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
pytest tests_new/ -k "commission and not precision"

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
pytest tests_new/unit/test_commission_contracts.py::TestCommissionContracts::test_commission_calculation_contract[case1] -v
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest tests_new/ --durations=0

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests_new/ --durations=10 --durations-min=1.0
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
# –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –ø–∞–º—è—Ç–∏
pytest tests_new/ --memprof

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
pytest tests_new/ -n auto  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pytest tests_new/ -n 4     # 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞
```

---

## –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### üîÑ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ú–æ–¥—É–ª—å `tests_new/utils/data_updater.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

#### –ß—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
1. **–í–µ—Å–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏**: –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ Shopfans
2. **–î–∏–∞–ø–∞–∑–æ–Ω—ã –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç**: –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ –∫—É—Ä—Å–∞ CBR
3. **–ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏**: –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏
4. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö URL**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–æ–∫

#### –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```bash
# –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
python tests_new/utils/data_updater.py

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
python -c "
from tests_new.utils.data_updater import TestDataUpdater
import asyncio

async def main():
    updater = TestDataUpdater()
    await updater.update_shipping_expectations()
    await updater.update_currency_ranges()

asyncio.run(main())
"

# –ß–µ—Ä–µ–∑ Makefile
make test-update-data
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ CI/CD
```yaml
# GitHub Actions: –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- name: Update test data
  run: python tests_new/utils/data_updater.py
  schedule:
    - cron: '0 2 * * 1'  # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 02:00
```

### üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–§–∞–π–ª `tests_new/fixtures/test_data.json`:
```json
{
  "last_updated": "2025-06-09T12:00:00Z",
  "test_urls": {
    "ebay": [
      {
        "url": "https://www.ebay.com/itm/266024628787",
        "description": "Nike Air Jordan 1 High OG Chicago",
        "expected_price_range": [100, 300],
        "last_verified": "2025-06-09",
        "status": "accessible"
      }
    ]
  },
  "shipping_expectations": {
    "Supreme hoodie black large": {
      "weight": 0.7,
      "cost": 18.99,
      "cost_range": [16.99, 20.99],
      "pattern_matched": "hoodie",
      "updated": "2025-06-09T12:00:00Z"
    }
  },
  "commission_examples": [
    {
      "item_price": 120,
      "us_shipping": 40,
      "commission_base": 160,
      "expected_commission": 16.00,
      "commission_type": "percentage",
      "updated": "2025-06-09T12:00:00Z"
    }
  ]
}
```

### üîß –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```python
# tests_new/utils/custom_updater.py
from data_updater import TestDataUpdater

class CustomTestDataUpdater(TestDataUpdater):
    """–ö–∞—Å—Ç–æ–º–Ω—ã–π updater —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π."""
    
    async def update_custom_expectations(self):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–∂–∏–¥–∞–Ω–∏–π."""
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        pass
    
    async def validate_updated_data(self):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
        data = self.load_test_data()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
        for url_data in data.get('test_urls', {}).get('ebay', []):
            assert 'url' in url_data
            assert 'last_verified' in url_data
        
        print("‚úÖ Validation passed")
```

---

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ö–æ—Ä–æ—à–∏—Ö —Ç–µ—Å—Ç–æ–≤

#### 1. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
```python
# ‚ùå –ü–ª–æ—Ö–æ: –Ω–µ—è—Å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
def test_commission():
    pass

# ‚úÖ –•–æ—Ä–æ—à–æ: –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
def test_commission_calculation_with_high_shipping_above_threshold():
    pass

# ‚úÖ –ï—â—ë –ª—É—á—à–µ: —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
def test_commission_calculation_for_160_dollar_base_should_use_percentage_rate():
    pass
```

#### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ (AAA Pattern)
```python
def test_function_behavior(self):
    """–¢–µ—Å—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏."""
    # Arrange: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    input_data = create_test_input()
    expected_output = "expected_result"
    
    # Act: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    actual_output = function_under_test(input_data)
    
    # Assert: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    assert actual_output == expected_output, f"Expected {expected_output}, got {actual_output}"
```

#### 3. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤
```python
# ‚ùå –ü–ª–æ—Ö–æ: —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
class TestBadExample:
    shared_state = None
    
    def test_step_1(self):
        self.shared_state = "initialized"
    
    def test_step_2(self):
        assert self.shared_state == "initialized"  # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç test_step_1

# ‚úÖ –•–æ—Ä–æ—à–æ: –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
class TestGoodExample:
    def test_scenario_1(self, fresh_state):
        # –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        assert process_data(fresh_state) == "expected_result"
    
    def test_scenario_2(self, fresh_state):
        # –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–æ–≤
        assert process_data(fresh_state) == "expected_result"
```

#### 4. –û—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
```python
# ‚ùå –ü–ª–æ—Ö–æ: –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∞—è –æ—à–∏–±–∫–∞
assert result == expected

# ‚úÖ –•–æ—Ä–æ—à–æ: –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
assert result == expected, f"Commission calculation failed: item=${item_price}, shipping=${us_shipping}, expected=${expected}, got=${result}"

# ‚úÖ –ï—â—ë –ª—É—á—à–µ: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
assert result.commission == expected_commission, (
    f"Commission calculation failed for case: {description}\n"
    f"Input: item=${item_price}, us_shipping=${us_shipping}\n"
    f"Expected commission: ${expected_commission}\n" 
    f"Actual commission: ${result.commission}\n"
    f"Commission base: ${item_price + us_shipping}"
)
```

### üéØ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞

#### 1. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
```python
class TestCommissionCalculation:
    """–í—Å–µ —Ç–µ—Å—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ."""
    
    def test_fixed_commission_below_threshold(self):
        pass
    
    def test_percentage_commission_above_threshold(self):
        pass
    
    def test_threshold_boundary_cases(self):
        pass

class TestShippingEstimation:
    """–í—Å–µ —Ç–µ—Å—Ç—ã –æ—Ü–µ–Ω–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ."""
    
    def test_pattern_matching(self):
        pass
    
    def test_weight_calculation(self):
        pass
```

#### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏
```python
@pytest.mark.parametrize("item_price,us_shipping,expected_commission,description", [
    (80, 20, 15.00, "Below threshold with shipping"),
    (120, 40, 16.00, "Above threshold due to shipping"),
    (200, 50, 25.00, "High value with high shipping"),
])
def test_commission_calculation_scenarios(self, item_price, us_shipping, expected_commission, description):
    """–¢–µ—Å—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏."""
    result = calculate_final_price(
        Decimal(str(item_price)),
        Decimal(str(us_shipping)),
        Decimal("25.00")
    )
    assert result.commission == Decimal(str(expected_commission))
```

#### 3. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä
```python
# –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞ –≤ conftest.py
@pytest.fixture
def mock_config():
    """–ú–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤."""
    with patch('app.config.config') as mock:
        mock.commission.fixed_amount = 15.0
        yield mock

# –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞
@pytest.fixture
def high_value_item():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ –≤—ã—Å–æ–∫–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏."""
    return ItemData(
        price=Decimal("200.00"),
        shipping_us=Decimal("25.00"),
        is_buyable=True,
        title="Expensive item"
    )
```

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 1. –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã
```python
# ‚úÖ –•–æ—Ä–æ—à–æ: –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ I/O
def test_calculation_logic():
    result = pure_function(input_data)
    assert result == expected

# ‚ùå –ü–ª–æ—Ö–æ: –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å I/O –≤ unit —Ç–µ—Å—Ç–∞—Ö
def test_calculation_with_database():
    # –ù–µ –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –≤ unit —Ç–µ—Å—Ç–∞—Ö
    data = fetch_from_database()
    result = calculate(data)
```

#### 2. –£–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤
```python
# ‚úÖ –•–æ—Ä–æ—à–æ: –º–æ–∫ —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
@patch('app.external_service.api_call')
def test_business_logic(mock_api):
    mock_api.return_value = "mocked_response"
    result = business_function()
    assert result.processed_correctly

# ‚ùå –ü–ª–æ—Ö–æ: –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –º–æ–∫–∞–Ω–∏–µ
@patch('app.internal_module.helper_function')  # –ù–µ –º–æ–∫–∞–π—Ç–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
def test_over_mocked(mock_helper):
    pass
```

#### 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pytest-xdist –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
pip install pytest-xdist

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pytest tests_new/ -n auto

# –£–∫–∞–∑–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
pytest tests_new/ -n 4
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤

#### 1. –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫—Ä—ã—Ç–∏—è
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
pytest tests_new/ --cov=app --cov-fail-under=70

# –û—Ç—á—ë—Ç –ø–æ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã–º —Å—Ç—Ä–æ–∫–∞–º
pytest tests_new/ --cov=app --cov-report=term-missing

# HTML –æ—Ç—á—ë—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
pytest tests_new/ --cov=app --cov-report=html
open htmlcov/index.html
```

#### 2. –ê–Ω–∞–ª–∏–∑ —Ñ–ª–∞–∫–∏–Ω–µ—Å–∞ (–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
```bash
# –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
pytest tests_new/ --count=10

# –ó–∞–ø—É—Å–∫ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–∞–¥–µ–Ω–∏—è
pytest tests_new/ --maxfail=1 --count=100
```

#### 3. –ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# tests_new/test_performance.py
import pytest

@pytest.mark.benchmark
def test_commission_calculation_performance(benchmark):
    """–ë–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏."""
    result = benchmark(
        calculate_final_price,
        Decimal("100"),
        Decimal("15"),
        Decimal("25")
    )
    assert result.commission > 0

# –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤
pytest tests_new/ -k benchmark --benchmark-json=benchmark.json
```

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –¢—Ä–∏ —É—Ä–æ–≤–Ω—è —Ç–µ—Å—Ç–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ  
‚úÖ **–°–∫–æ—Ä–æ—Å—Ç—å**: Unit —Ç–µ—Å—Ç—ã –¥–∞—é—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: CI/CD –∏—Å–∫–ª—é—á–∞–µ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏  
‚úÖ **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å**: E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ  

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏

#### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: `make test-update-data`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL: `make test-verify`
- –ê–Ω–∞–ª–∏–∑ –æ—Ç—á—ë—Ç–æ–≤ –ø–æ–∫—Ä—ã—Ç–∏—è –≤ CI/CD

#### –ï–∂–µ–º–µ—Å—è—á–Ω–æ
- –û–±–∑–æ—Ä –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: `pytest --durations=20`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ requirements-dev.txt
- –ê–Ω–∞–ª–∏–∑ —Ñ–ª–∞–∫–∏–Ω–µ—Å–∞ –≤ CI/CD –ª–æ–≥–∞—Ö

#### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
1. –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
2. –î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å E2E —Ç–µ—Å—Ç—ã
4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ –ø—Ä–∏–º–µ—Ä—ã

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `tests_new/README.md`
2. –ò–∑—É—á–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞—Ö
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `pytest --help` –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ pytest
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ pytest](https://docs.pytest.org/)

---

*–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏. –°–ª–µ–¥—É–π—Ç–µ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º, –∏ –≤–∞—à–∏ —Ç–µ—Å—Ç—ã —Å—Ç–∞–Ω—É—Ç –Ω–∞–¥—ë–∂–Ω–æ–π –∑–∞—â–∏—Ç–æ–π –æ—Ç –±–∞–≥–æ–≤! üõ°Ô∏è*